<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Master - Nova Vers√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        header p {
            color: rgba(255, 255, 255, 0.7);
        }

        .menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .menu-card {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .menu-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
        }

        .menu-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .menu-card h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .menu-card p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Sections */
        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Chat Section */
        .chat-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .avatar.speaking {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }

            50% {
                transform: scale(1.05);
                box-shadow: 0 0 20px 10px rgba(102, 126, 234, 0.3);
            }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
            max-height: 300px;
        }

        .message {
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 15px;
            max-width: 85%;
        }

        .message.emma {
            background: linear-gradient(135deg, #667eea, #764ba2);
            margin-right: auto;
        }

        .message.user {
            background: rgba(255, 255, 255, 0.1);
            margin-left: auto;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            padding: 15px 20px;
            color: white;
            font-size: 1rem;
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .send-btn,
        .voice-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .send-btn:hover,
        .voice-btn:hover {
            transform: scale(1.1);
        }

        .voice-btn.recording {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            animation: pulse 1s infinite;
        }

        /* Grammar Section */
        .grammar-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
        }

        .question-text {
            font-size: 1.3rem;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .options {
            display: grid;
            gap: 15px;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: #667eea;
        }

        .option-btn.correct {
            background: rgba(34, 197, 94, 0.3);
            border-color: #22c55e;
        }

        .option-btn.wrong {
            background: rgba(239, 68, 68, 0.3);
            border-color: #ef4444;
        }

        .option-btn:disabled {
            cursor: not-allowed;
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            display: none;
        }

        .feedback.show {
            display: block;
            animation: fadeIn 0.3s;
        }

        .feedback.correct {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
        }

        .feedback.wrong {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
        }

        .next-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 15px;
            padding: 15px 40px;
            color: white;
            font-size: 1.1rem;
            cursor: pointer;
            margin-top: 20px;
            transition: transform 0.2s;
        }

        .next-btn:hover {
            transform: scale(1.05);
        }

        .score {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }

        /* Topics */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .topic-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .topic-btn:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .topic-btn .emoji {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üéì English Master</h1>
            <p>Aprenda ingl√™s de forma divertida!</p>
        </header>

        <!-- Menu Principal -->
        <div id="mainMenu" class="section active">
            <div class="menu">
                <div class="menu-card" onclick="showSection('chatSection')">
                    <div class="icon">ü§ñ</div>
                    <h3>Conversar com Emma</h3>
                    <p>Pratique ingl√™s em conversas reais com nossa IA</p>
                </div>
                <div class="menu-card" onclick="showSection('grammarSection')">
                    <div class="icon">üìñ</div>
                    <h3>Gram√°tica</h3>
                    <p>Pratique tempos verbais e estruturas</p>
                </div>
                <div class="menu-card" onclick="showSection('vocabSection')">
                    <div class="icon">üìö</div>
                    <h3>Vocabul√°rio</h3>
                    <p>Aprenda novas palavras todos os dias</p>
                </div>
                <div class="menu-card" onclick="showSection('listeningSection')">
                    <div class="icon">üéß</div>
                    <h3>Listening</h3>
                    <p>Treine sua compreens√£o auditiva</p>
                </div>
            </div>
        </div>

        <!-- Chat Section -->
        <div id="chatSection" class="section">
            <button class="back-btn" onclick="showSection('mainMenu')">‚Üê Voltar</button>

            <div id="topicSelect">
                <h2 style="margin-bottom: 20px;">Escolha um tema para conversar:</h2>
                <div class="topics-grid">
                    <button class="topic-btn" onclick="startChat('greetings')">
                        <span class="emoji">üëã</span>
                        Cumprimentos
                    </button>
                    <button class="topic-btn" onclick="startChat('food')">
                        <span class="emoji">üçï</span>
                        Comida
                    </button>
                    <button class="topic-btn" onclick="startChat('travel')">
                        <span class="emoji">‚úàÔ∏è</span>
                        Viagens
                    </button>
                    <button class="topic-btn" onclick="startChat('work')">
                        <span class="emoji">üíº</span>
                        Trabalho
                    </button>
                    <button class="topic-btn" onclick="startChat('hobbies')">
                        <span class="emoji">üéÆ</span>
                        Hobbies
                    </button>
                    <button class="topic-btn" onclick="startChat('free')">
                        <span class="emoji">üí¨</span>
                        Conversa Livre
                    </button>
                </div>
            </div>

            <div class="chat-container" id="chatContainer" style="display: none;">
                <div class="chat-header">
                    <div class="avatar" id="emmaAvatar">üë©‚Äçüè´</div>
                    <div>
                        <h3>Emma</h3>
                        <p style="color: rgba(255,255,255,0.6); font-size: 0.9rem;">Sua professora de ingl√™s</p>
                    </div>
                </div>

                <div class="chat-messages" id="chatMessages"></div>

                <div class="chat-input-area">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Digite sua mensagem em ingl√™s..."
                        onkeypress="handleEnter(event)">
                    <button class="voice-btn" id="voiceBtn" onclick="startVoice()">üé§</button>
                    <button class="send-btn" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
        </div>

        <!-- Grammar Section -->
        <div id="grammarSection" class="section">
            <button class="back-btn" onclick="showSection('mainMenu')">‚Üê Voltar</button>

            <div class="score">
                <p>Pontua√ß√£o</p>
                <div class="score-number"><span id="correctCount">0</span> / <span id="totalCount">0</span></div>
            </div>

            <div class="grammar-card">
                <p id="questionContext" style="color: #667eea; margin-bottom: 10px; font-size: 0.9rem;"></p>
                <p class="question-text" id="questionText"></p>

                <div class="options" id="optionsContainer"></div>

                <div class="feedback" id="feedback">
                    <p id="feedbackText"></p>
                </div>

                <button class="next-btn" id="nextBtn" onclick="nextQuestion()" style="display: none;">Pr√≥xima Quest√£o
                    ‚Üí</button>
            </div>
        </div>

        <!-- Vocabulary Section -->
        <div id="vocabSection" class="section">
            <button class="back-btn" onclick="showSection('mainMenu')">‚Üê Voltar</button>

            <div class="grammar-card" style="text-align: center;">
                <p style="color: #667eea; margin-bottom: 10px;">Palavra do Dia</p>
                <h2 id="vocabWord" style="font-size: 2.5rem; margin-bottom: 10px;"></h2>
                <p id="vocabPronunciation" style="color: rgba(255,255,255,0.6); margin-bottom: 20px;"></p>
                <button class="send-btn" onclick="speakWord()"
                    style="border-radius: 15px; width: auto; padding: 15px 30px;">üîä Ouvir</button>
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <p style="color: rgba(255,255,255,0.6);">Tradu√ß√£o:</p>
                    <p id="vocabTranslation" style="font-size: 1.3rem; margin-top: 10px;"></p>
                </div>
                <div style="margin-top: 20px;">
                    <p style="color: rgba(255,255,255,0.6);">Exemplo:</p>
                    <p id="vocabExample" style="font-size: 1.1rem; margin-top: 10px; font-style: italic;"></p>
                </div>
                <button class="next-btn" onclick="nextVocab()" style="margin-top: 30px;">Nova Palavra ‚Üí</button>
            </div>
        </div>

        <!-- Listening Section -->
        <div id="listeningSection" class="section">
            <button class="back-btn" onclick="showSection('mainMenu')">‚Üê Voltar</button>

            <div class="grammar-card" style="text-align: center;">
                <p style="color: #667eea; margin-bottom: 20px;">Ou√ßa e escreva o que voc√™ ouviu:</p>
                <button class="send-btn" onclick="playListening()"
                    style="border-radius: 15px; width: auto; padding: 20px 40px; font-size: 1.5rem;">üîä Ouvir</button>

                <input type="text" class="chat-input" id="listeningInput" placeholder="Digite o que voc√™ ouviu..."
                    style="margin-top: 30px; text-align: center;">

                <button class="next-btn" onclick="checkListening()" style="margin-top: 20px;">Verificar</button>

                <div class="feedback" id="listeningFeedback">
                    <p id="listeningFeedbackText"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== DATA =====
        const chatResponses = {
            greetings: {
                starters: [
                    "Hello! How are you today? I'm Emma, your English teacher! üòä",
                    "Hi there! Nice to meet you! What's your name?",
                    "Good day! I'm so happy to practice English with you!"
                ],
                responses: [
                    "That's wonderful! Tell me more about yourself.",
                    "Interesting! How long have you been learning English?",
                    "Great! What do you like to do in your free time?",
                    "I understand! Learning English is a great journey.",
                    "That's nice! Do you practice English every day?",
                    "Excellent! Your English is improving!"
                ]
            },
            food: {
                starters: [
                    "Let's talk about food! What's your favorite dish? üçï",
                    "I love food! Do you like to cook?",
                    "What did you have for breakfast today?"
                ],
                responses: [
                    "Yummy! That sounds delicious!",
                    "I've never tried that! Is it spicy or sweet?",
                    "Do you know how to cook that dish?",
                    "What's the most exotic food you've ever eaten?",
                    "Do you prefer eating at home or at restaurants?"
                ]
            },
            travel: {
                starters: [
                    "I love traveling! Have you ever been abroad? ‚úàÔ∏è",
                    "Let's talk about travel! What's your dream destination?",
                    "Where was your last trip?"
                ],
                responses: [
                    "That sounds amazing! What did you see there?",
                    "I'd love to visit that place too!",
                    "Did you try any local food there?",
                    "How long was your trip?",
                    "Do you prefer beaches or mountains?"
                ]
            },
            work: {
                starters: [
                    "Tell me about your work! What do you do? üíº",
                    "Do you enjoy your job?",
                    "What's a typical day like at your work?"
                ],
                responses: [
                    "That sounds interesting! Do you work with a team?",
                    "How long have you been doing this job?",
                    "What's the best part of your job?",
                    "Do you work from home or in an office?",
                    "What skills are important for your job?"
                ]
            },
            hobbies: {
                starters: [
                    "What do you like to do for fun? üéÆ",
                    "Do you have any hobbies?",
                    "How do you spend your weekends?"
                ],
                responses: [
                    "That's a great hobby! How did you start?",
                    "Do you do that alone or with friends?",
                    "How often do you practice this hobby?",
                    "Have you tried any new hobbies recently?",
                    "What hobby would you like to learn?"
                ]
            },
            free: {
                starters: [
                    "Hi! I'm Emma. What would you like to talk about today? üí¨",
                    "Hello! Feel free to talk about anything you want!",
                    "Hi there! Let's have a nice conversation in English!"
                ],
                responses: [
                    "That's interesting! Tell me more.",
                    "I see! What do you think about that?",
                    "Really? That's fascinating!",
                    "Oh, I understand. How does that make you feel?",
                    "Interesting perspective! Can you explain more?",
                    "That's a good point! What else?"
                ]
            }
        };

        // ===== INFINITE GRAMMAR GENERATOR =====
        const grammarTemplates = {
            presentSimple: {
                context: "Present Simple",
                subjects: ["She", "He", "My brother", "The teacher", "My friend"],
                verbs: [
                    { base: "work", third: "works" },
                    { base: "go", third: "goes" },
                    { base: "study", third: "studies" },
                    { base: "play", third: "plays" },
                    { base: "live", third: "lives" },
                    { base: "watch", third: "watches" },
                    { base: "read", third: "reads" },
                    { base: "speak", third: "speaks" }
                ],
                endings: ["every day.", "at 8 AM.", "on weekends.", "after lunch.", "in the morning."],
                explanation: "Com he/she/it no presente simples, adicionamos -s/-es ao verbo."
            },
            presentContinuous: {
                context: "Present Continuous",
                subjects: ["I", "She", "We", "They", "He"],
                verbs: ["studying", "working", "playing", "cooking", "reading", "watching", "writing", "learning"],
                endings: ["right now.", "at the moment.", "currently.", "today."],
                explanation: "Usamos be + verbo-ing para a√ß√µes acontecendo agora."
            },
            pastSimple: {
                context: "Past Simple",
                timeExpressions: ["Yesterday", "Last week", "Two days ago", "Last night", "Last month"],
                subjects: ["I", "She", "We", "They", "He"],
                verbs: [
                    { base: "watch", past: "watched" },
                    { base: "play", past: "played" },
                    { base: "study", past: "studied" },
                    { base: "visit", past: "visited" },
                    { base: "go", past: "went" },
                    { base: "see", past: "saw" },
                    { base: "eat", past: "ate" },
                    { base: "buy", past: "bought" }
                ],
                explanation: "Usamos o passado simples para a√ß√µes completas no passado."
            },
            futureSimple: {
                context: "Future Simple",
                subjects: ["I", "She", "We", "They", "He"],
                verbs: ["go", "study", "work", "travel", "visit", "buy", "learn"],
                timeExpressions: ["tomorrow.", "next week.", "next year.", "soon.", "next month."],
                explanation: "Usamos will + verbo para falar do futuro."
            },
            modals: {
                context: "Modal Verbs",
                subjects: ["She", "He", "I", "We", "They"],
                modals: ["can", "should", "must", "could", "might"],
                verbs: ["speak", "drive", "swim", "cook", "play", "sing", "dance"],
                endings: ["very well.", "fluently.", "perfectly.", "professionally."],
                explanation: "Modal verbs n√£o mudam com o sujeito e s√£o seguidos de verbo base."
            },
            comparatives: {
                context: "Comparatives",
                nouns: ["This car", "This book", "This movie", "This restaurant", "This phone"],
                adjectives: [
                    { base: "fast", comp: "faster" },
                    { base: "big", comp: "bigger" },
                    { base: "interesting", comp: "more interesting" },
                    { base: "beautiful", comp: "more beautiful" },
                    { base: "expensive", comp: "more expensive" },
                    { base: "good", comp: "better" },
                    { base: "bad", comp: "worse" }
                ],
                explanation: "Adjetivos curtos: + er. Adjetivos longos: more + adjetivo."
            }
        };

        let currentGeneratedQuestion = null;

        function generateQuestion() {
            const types = Object.keys(grammarTemplates);
            const type = types[Math.floor(Math.random() * types.length)];
            const template = grammarTemplates[type];

            let question, options, correct, explanation;

            switch (type) {
                case 'presentSimple':
                    const subj1 = template.subjects[Math.floor(Math.random() * template.subjects.length)];
                    const verb1 = template.verbs[Math.floor(Math.random() * template.verbs.length)];
                    const end1 = template.endings[Math.floor(Math.random() * template.endings.length)];
                    question = `${subj1} ___ ${end1}`;
                    correct = verb1.third;
                    options = shuffleArray([verb1.third, verb1.base, verb1.base + "ing", "to " + verb1.base]);
                    explanation = template.explanation;
                    break;

                case 'presentContinuous':
                    const subj2 = template.subjects[Math.floor(Math.random() * template.subjects.length)];
                    const verb2 = template.verbs[Math.floor(Math.random() * template.verbs.length)];
                    const end2 = template.endings[Math.floor(Math.random() * template.endings.length)];
                    const be = subj2 === "I" ? "am" : (subj2 === "She" || subj2 === "He" ? "is" : "are");
                    question = `${subj2} ___ ${verb2} ${end2}`;
                    correct = be;
                    options = shuffleArray(["am", "is", "are", "be"]);
                    explanation = template.explanation;
                    break;

                case 'pastSimple':
                    const time3 = template.timeExpressions[Math.floor(Math.random() * template.timeExpressions.length)];
                    const subj3 = template.subjects[Math.floor(Math.random() * template.subjects.length)];
                    const verb3 = template.verbs[Math.floor(Math.random() * template.verbs.length)];
                    question = `${time3}, ${subj3} ___ a movie.`;
                    correct = verb3.past;
                    options = shuffleArray([verb3.past, verb3.base, verb3.base + "s", "will " + verb3.base]);
                    explanation = template.explanation;
                    break;

                case 'futureSimple':
                    const subj4 = template.subjects[Math.floor(Math.random() * template.subjects.length)];
                    const verb4 = template.verbs[Math.floor(Math.random() * template.verbs.length)];
                    const time4 = template.timeExpressions[Math.floor(Math.random() * template.timeExpressions.length)];
                    question = `${subj4} ___ to Paris ${time4}`;
                    correct = "will " + verb4;
                    options = shuffleArray(["will " + verb4, verb4 + "s", verb4 + "ed", "is " + verb4 + "ing"]);
                    explanation = template.explanation;
                    break;

                case 'modals':
                    const subj5 = template.subjects[Math.floor(Math.random() * template.subjects.length)];
                    const modal5 = template.modals[Math.floor(Math.random() * template.modals.length)];
                    const verb5 = template.verbs[Math.floor(Math.random() * template.verbs.length)];
                    const end5 = template.endings[Math.floor(Math.random() * template.endings.length)];
                    question = `${subj5} ${modal5} ___ ${end5}`;
                    correct = verb5;
                    options = shuffleArray([verb5, verb5 + "s", "to " + verb5, verb5 + "ing"]);
                    explanation = template.explanation;
                    break;

                case 'comparatives':
                    const noun6 = template.nouns[Math.floor(Math.random() * template.nouns.length)];
                    const adj6 = template.adjectives[Math.floor(Math.random() * template.adjectives.length)];
                    question = `${noun6} is ___ than that one.`;
                    correct = adj6.comp;
                    const wrongOptions = [adj6.base, "most " + adj6.base, adj6.base + "er"];
                    options = shuffleArray([adj6.comp, ...wrongOptions.slice(0, 3)]);
                    explanation = template.explanation;
                    break;
            }

            const correctIndex = options.indexOf(correct);

            return {
                context: template.context,
                question: question,
                options: options,
                correct: correctIndex,
                explanation: explanation
            };
        }

        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function loadQuestion() {
            currentGeneratedQuestion = generateQuestion();
            const q = currentGeneratedQuestion;

            document.getElementById('questionContext').textContent = "ü§ñ " + q.context + " (Gerado por IA)";
            document.getElementById('questionText').textContent = q.question;

            const container = document.getElementById('optionsContainer');
            container.innerHTML = q.options.map((opt, i) =>
                `<button class="option-btn" onclick="checkAnswer(${i})">${opt}</button>`
            ).join('');

            document.getElementById('feedback').className = 'feedback';
            document.getElementById('nextBtn').style.display = 'none';

            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalAnswers;
        }

        function checkAnswer(index) {
            const q = currentGeneratedQuestion;
            const buttons = document.querySelectorAll('.option-btn');

            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) {
                    btn.classList.add('correct');
                } else if (i === index) {
                    btn.classList.add('wrong');
                }
            });

            totalAnswers++;
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');

            if (index === q.correct) {
                correctAnswers++;
                feedback.className = 'feedback show correct';
                feedbackText.textContent = '‚úÖ Correto! ' + q.explanation;
            } else {
                feedback.className = 'feedback show wrong';
                feedbackText.innerHTML = '‚ùå Incorreto. A resposta correta era: <strong>' + q.options[q.correct] + '</strong><br>' + q.explanation;
            }

            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalAnswers;
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            loadQuestion();
        }

        const vocabulary = [
            { word: "Serendipity", pronunciation: "/Àåser…ônÀàd…™p…™ti/", translation: "Descoberta feliz por acaso", example: "Finding that book was pure serendipity." },
            { word: "Eloquent", pronunciation: "/Ààel…ôkw…ônt/", translation: "Eloquente, bem articulado", example: "She gave an eloquent speech." },
            { word: "Resilience", pronunciation: "/r…™Ààz…™li…ôns/", translation: "Resili√™ncia", example: "His resilience helped him overcome challenges." },
            { word: "Ephemeral", pronunciation: "/…™Ààfem…ôr…ôl/", translation: "Ef√™mero, passageiro", example: "The beauty of cherry blossoms is ephemeral." },
            { word: "Ubiquitous", pronunciation: "/juÀêÀàb…™kw…™t…ôs/", translation: "Onipresente", example: "Smartphones are ubiquitous nowadays." },
            { word: "Wanderlust", pronunciation: "/Ààw…índ…ôl åst/", translation: "Desejo de viajar", example: "Her wanderlust took her around the world." },
            { word: "Pragmatic", pronunciation: "/pr√¶…°Ààm√¶t…™k/", translation: "Pragm√°tico, pr√°tico", example: "We need a pragmatic approach to this problem." },
            { word: "Inevitable", pronunciation: "/…™nÀàev…™t…ôbl/", translation: "Inevit√°vel", example: "Change is inevitable." }
        ];

        const listeningPhrases = [
            "Hello, how are you?",
            "Nice to meet you.",
            "What time is it?",
            "I love learning English.",
            "See you tomorrow!",
            "Thank you very much.",
            "Can you help me?",
            "Where is the bathroom?"
        ];

        // ===== STATE =====
        let currentTopic = null;
        let currentQuestion = 0;
        let correctAnswers = 0;
        let totalAnswers = 0;
        let currentVocabIndex = 0;
        let currentListeningPhrase = "";
        let isRecording = false;

        // ===== FUNCTIONS =====
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            if (sectionId === 'grammarSection') {
                loadQuestion();
            } else if (sectionId === 'vocabSection') {
                loadVocab();
            } else if (sectionId === 'listeningSection') {
                loadListening();
            } else if (sectionId === 'chatSection') {
                document.getElementById('topicSelect').style.display = 'block';
                document.getElementById('chatContainer').style.display = 'none';
            }
        }

        // ===== CHAT =====
        function startChat(topic) {
            currentTopic = topic;
            document.getElementById('topicSelect').style.display = 'none';
            document.getElementById('chatContainer').style.display = 'flex';
            document.getElementById('chatMessages').innerHTML = '';

            const starters = chatResponses[topic].starters;
            const starter = starters[Math.floor(Math.random() * starters.length)];

            setTimeout(() => addMessage(starter, 'emma'), 500);
            speakText(starter);
        }

        function addMessage(text, sender) {
            const messages = document.getElementById('chatMessages');
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.textContent = text;
            messages.appendChild(div);
            messages.scrollTop = messages.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            if (!text) return;

            addMessage(text, 'user');
            input.value = '';

            // Emma thinking
            const avatar = document.getElementById('emmaAvatar');
            avatar.classList.add('speaking');

            setTimeout(() => {
                const responses = chatResponses[currentTopic].responses;
                const response = responses[Math.floor(Math.random() * responses.length)];
                addMessage(response, 'emma');
                speakText(response);
                avatar.classList.remove('speaking');
            }, 1000 + Math.random() * 1000);
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'en-US';
                u.rate = 0.9;

                const voices = window.speechSynthesis.getVoices();
                const englishVoice = voices.find(v => v.lang.includes('en'));
                if (englishVoice) u.voice = englishVoice;

                const avatar = document.getElementById('emmaAvatar');
                u.onstart = () => avatar?.classList.add('speaking');
                u.onend = () => avatar?.classList.remove('speaking');

                window.speechSynthesis.speak(u);
            }
        }

        function startVoice() {
            const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SR) {
                alert('Seu navegador n√£o suporta reconhecimento de voz. Use Chrome.');
                return;
            }

            const btn = document.getElementById('voiceBtn');

            if (isRecording) {
                isRecording = false;
                btn.classList.remove('recording');
                btn.textContent = 'üé§';
                return;
            }

            const recognition = new SR();
            recognition.lang = 'en-US';
            recognition.continuous = false;

            isRecording = true;
            btn.classList.add('recording');
            btn.textContent = 'üî¥';

            recognition.start();

            recognition.onresult = (e) => {
                const text = e.results[0][0].transcript;
                document.getElementById('chatInput').value = text;
                setTimeout(() => sendMessage(), 300);
            };

            recognition.onend = () => {
                isRecording = false;
                btn.classList.remove('recording');
                btn.textContent = 'üé§';
            };

            recognition.onerror = () => {
                isRecording = false;
                btn.classList.remove('recording');
                btn.textContent = 'üé§';
            };
        }

        // ===== GRAMMAR =====
        function loadQuestion() {
            if (currentQuestion >= grammarQuestions.length) {
                currentQuestion = 0;
            }

            const q = grammarQuestions[currentQuestion];
            document.getElementById('questionContext').textContent = q.context;
            document.getElementById('questionText').textContent = q.question;

            const container = document.getElementById('optionsContainer');
            container.innerHTML = q.options.map((opt, i) =>
                `<button class="option-btn" onclick="checkAnswer(${i})">${opt}</button>`
            ).join('');

            document.getElementById('feedback').className = 'feedback';
            document.getElementById('nextBtn').style.display = 'none';

            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalAnswers;
        }

        function checkAnswer(index) {
            const q = grammarQuestions[currentQuestion];
            const buttons = document.querySelectorAll('.option-btn');

            buttons.forEach((btn, i) => {
                btn.disabled = true;
                if (i === q.correct) {
                    btn.classList.add('correct');
                } else if (i === index) {
                    btn.classList.add('wrong');
                }
            });

            totalAnswers++;
            const feedback = document.getElementById('feedback');
            const feedbackText = document.getElementById('feedbackText');

            if (index === q.correct) {
                correctAnswers++;
                feedback.className = 'feedback show correct';
                feedbackText.textContent = '‚úÖ Correto! ' + q.explanation;
            } else {
                feedback.className = 'feedback show wrong';
                feedbackText.textContent = '‚ùå Incorreto. ' + q.explanation;
            }

            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalAnswers;
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // ===== VOCABULARY =====
        function loadVocab() {
            const v = vocabulary[currentVocabIndex];
            document.getElementById('vocabWord').textContent = v.word;
            document.getElementById('vocabPronunciation').textContent = v.pronunciation;
            document.getElementById('vocabTranslation').textContent = v.translation;
            document.getElementById('vocabExample').textContent = `"${v.example}"`;
        }

        function speakWord() {
            const word = vocabulary[currentVocabIndex].word;
            speakText(word);
        }

        function nextVocab() {
            currentVocabIndex = (currentVocabIndex + 1) % vocabulary.length;
            loadVocab();
        }

        // ===== LISTENING =====
        function loadListening() {
            currentListeningPhrase = listeningPhrases[Math.floor(Math.random() * listeningPhrases.length)];
            document.getElementById('listeningInput').value = '';
            document.getElementById('listeningFeedback').className = 'feedback';
        }

        function playListening() {
            speakText(currentListeningPhrase);
        }

        function checkListening() {
            const input = document.getElementById('listeningInput').value.trim().toLowerCase();
            const correct = currentListeningPhrase.toLowerCase().replace(/[?!.,]/g, '');

            const feedback = document.getElementById('listeningFeedback');
            const feedbackText = document.getElementById('listeningFeedbackText');

            if (input === correct || input === currentListeningPhrase.toLowerCase()) {
                feedback.className = 'feedback show correct';
                feedbackText.textContent = '‚úÖ Perfeito! A frase era: "' + currentListeningPhrase + '"';
            } else {
                feedback.className = 'feedback show wrong';
                feedbackText.textContent = '‚ùå Quase! A frase correta era: "' + currentListeningPhrase + '"';
            }

            setTimeout(() => loadListening(), 3000);
        }

        // Preload voices
        if ('speechSynthesis' in window) {
            window.speechSynthesis.getVoices();
        }

        console.log('üéì English Master Nova Vers√£o carregado!');
    </script>
</body>

</html>